#summary A quick guide for creating a SADI service for wrapping a SOAP service
#labels Phase-Implementation,SOAP,Tutorial,WebService

= Introduction =
Here we present a step by step guide for creating a Java SADI service that wraps an existing [http://www.ebi.ac.uk/chebi/ ChEBI] [http://www.ebi.ac.uk/webservices/chebi/2.0/webservice?wsdl SOAP service] for getting the charge of a molecule. This guide extends [http://sadiframework.org/content/getting-involved/building-a-sadi-service-in-java/ Building a SADI service in Java].

= Create an OWL document describing your Input and Output =
The input and outputs of all SADI services must be described in a  dereferenceable OWL ontology document. For this example we will be using the following input and output classes:

Input class description:
{{{
'ChEBI Entity' that 'has attribute' some 'ChEBI Identifier'
}}}
Where:
{{{
'ChEBI identifier 'has value' some Literal
}}}

*Note*: We use only valid ChEBI identifiers as the associated value of the 'ChEBI identifier' class, i.e.: "CHEBI:29977"

Output class description:
{{{
'ChEBI Entity' that 'has attribute' some Charge
}}}

Where:
{{{
Charge 'has value' some Literal
}}}

*Note*: The literal associated with the Charge attribute will have as value the value returned from the SOAP service call. 

The resulting OWL document has been made available [http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl here]
  
= Generate the SADI service code =
After creating a Maven project modify the pom.xml file and make sure that the following nodes are included
{{{
<packaging>war</packaging>
}}}

{{{
<build>
  <finalName>sadi-service-example</finalName>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-compiler-plugin</artifactId>
      <configuration>
        <source>1.6</source>
        <target>1.6</target>
      </configuration>
    </plugin>
    <plugin>
      <groupId>org.mortbay.jetty</groupId>
      <artifactId>maven-jetty-plugin</artifactId>
      <version>6.1.24</version>
      <configuration>
        <contextPath>/sadi-services</contextPath>
      </configuration>
    </plugin>
    <plugin>
      <groupId>ca.wilkinsonlab.sadi</groupId>
      <artifactId>sadi-generator</artifactId>
      <version>0.1.0-SNAPSHOT</version>
    </plugin>
    <plugin>
      <groupId>ca.wilkinsonlab.sadi</groupId>
      <artifactId>sadi-tester</artifactId>
      <version>0.1.0-SNAPSHOT</version>
    </plugin>
  </plugins>
</build>
}}}
 

{{{
<pluginRepositories>
  <pluginRepository>
    <id>dev.biordf.net</id>
    <name>dev.biordf.net</name>
    <url>http://dev.biordf.net/maven</url>
  </pluginRepository>
</pluginRepositories>
<repositories>
  <repository>
    <id>dev.biordf.net</id>
    <name>dev.biordf.net</name>
    <url>http://dev.biordf.net/maven</url>
  </repository>
</repositories>
<dependencies>
  <dependency>
    <groupId>ca.wilkinsonlab.sadi</groupId>
    <artifactId>sadi-service</artifactId>
    <version>0.1.0-SNAPSHOT</version>
  </dependency>
</dependencies>
}}}

== Run the SADI service generator Maven plugin ==
*If you are using Eclipse* you can download the runtime maven configuration file from [http://sadi-data.semanticscience.org/setup/runconfigs.zip here]. Create a directory inside of your Maven project and extract to it the contents of the zip file. Now you can go to Run->Run configurations and from the left panel select "generate sadi service" under the Maven Build menu and change the serviceName, serviceClass, inputClass, outputClass and contact email.
We strongly recommend that you also add the serviceDescription parameter to your run configuration and provide a complete human readable description of what this service does. i.e.:


{{{
This SADI service wraps the SOAP service ChebiWebServiceService located  at
http://www.ebi.ac.uk/webservices/chebi/2.0/webservice?wsdl. It calls the 
operation getChebiAsciiName. This service takes as an input an 
instance of the class 
http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00030 
a ChEBI Entity that has attribute some ChEBI Identifier.
It returns as an output an instance of the class 
http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00035, 
a ChEBI entity and has attribute some Charge. 
http://sadi-data.semanticscience.org/ChebiGetChargeSadiWrapper/input.rdf  
contains an example of an input and 
http://sadi-data.semanticscience.org/ChebiGetChargeSadiWrapper/output.rdf 
contains the corresponding output.
}}}

Once ready click on RUN. 

*If you are not using Eclipse* you can go to the location of your project on your file system and run the following command
{{{
$ mvn ca.wilkinsonlab.sadi:sadi-generator:generate-service 
  -DserviceName=sadi-sercice-example 
  -DserviceClass=com.example.HelloWorldService 
  -DinputClass=http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00030  -DoutputClass=http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00034 
  -DcontactEmail=your-email-address
  -DserviceDescription=This service takes as an input a 
}}}

The service generator plugin should now have created a Java stub under src/main/java

== Add CXF as a dependency to your project ==
Add the following dependencies to your POM file:
{{{
<dependencies>
...
  <dependency>
    <groupId>org.apache.cxf</groupId>
    <artifactId>cxf-rt-frontend-jaxws</artifactId>
    <version>2.3.1</version>
  </dependency>
  <dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.6.1</version>
  </dependency>
  <dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-log4j12</artifactId>
    <version>1.6.1</version>
  </dependency>
  <dependency>
    <groupId>org.apache.cxf</groupId>
    <artifactId>cxf-rt-transports-http</artifactId>
    <version>2.3.1</version>
  </dependency>
...
</dependencies>

}}}

Recall that for this example we will be making use of http://www.ebi.ac.uk/webservices/chebi/2.0/webservice?wsdl as the WSDL file that will be consumed by CXF.

Now add the following plugins to the build configuration in your POM file:

{{{
<build>
  <plugins>
   ...
    <plugin>
      <groupId>org.apache.cxf</groupId>
      <artifactId>cxf-codegen-plugin</artifactId>
      <version>2.3.1</version>
      <executions>
        <execution>
          <id>generate-sources</id>
          <phase>generate-sources</phase>
          <configuration>
            <sourceRoot>${basedir}/src/main/java</sourceRoot>
            <wsdlOptions>
              <wsdlOption>
                <wsdl>http://www.ebi.ac.uk/webservices/chebi/2.0/webservice?wsdl</wsdl>
                <extraargs>
                  <extraarg>-client</extraarg>
                </extraargs>
                <bindingFiles>
                  <bindingFile>http://sadi-data.semanticscience.org/setup/bindings.xml</bindingFile>
                </bindingFiles>
              </wsdlOption>
            </wsdlOptions>
          </configuration>
          <goals>
            <goal>wsdl2java</goal>
          </goals>
        </execution>
      </executions>
    </plugin>
    <!-- Add generated sources - avoids having to copy generated sources to build location -->
    <plugin>
      <groupId>org.codehaus.mojo</groupId>
      <artifactId>build-helper-maven-plugin</artifactId>
      <version>1.5</version>
      <executions>
        <execution>
          <id>add-source</id>
          <phase>generate-sources</phase>
          <goals>
            <goal>add-source</goal>
          </goals>
          <configuration>
            <sources>
              <source>${basedir}/target/generated/src/main/java</source>
            </sources>
          </configuration>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <artifactId>maven-assembly-plugin</artifactId>
      <configuration>
        <descriptorRefs>
          <descriptorRef>jar-with-dependencies</descriptorRef>
        </descriptorRefs>
      </configuration>
    </plugin>
  ...
  </plugins>
</build>

}}}

The only items of interest in the POM are:
 * We depend on the CXF v2.3.1 client libraries
 * We invoke the cxf-codegen-plugin to run wsdl2java to generate our Java stub code into ${basedir}/target/generated/src/main/java
 * We use the build-helper-maven-plugin so that Maven can compile from two source directories. Thus allowing us to compile what is in ${basedir}/src/main and ${basedir}/target/generated/src/main/java
 * We use the maven-assembly-plugin to create a final JAR containing all necessary dependencies when we perform a mvn assembly:assembly
 * We use a binding file to avoid the usage of [http://download.oracle.com/javase/6/docs/api/javax/xml/bind/JAXBElement.html JAXBElements] -> http://sadi-data.semanticscience.org/setup/bindings.xml


== Assemble the Java code ==
In order to execute the wsdl2java function from CXF you now need to run:
{{{
mvn assembly:assembly
}}}
from the command line in your project's directory. This will create the Java code from the WSDL file and thus let us communicate with the SOAP web service. 


== Make the SOAP call within the SADI service ==

Open src /main/java/org/semanticscience/sadi/soapwrapper/chebisoap/GetCharge.java and you should have the following code
{{{
package org.semanticscience.sadi.soapwrapper.chebisoap;

import org.apache.log4j.Logger;

import ca.wilkinsonlab.sadi.service.annotations.Name; 
import ca.wilkinsonlab.sadi.service.annotations.Description; 
import ca.wilkinsonlab.sadi.service.annotations.ContactEmail; 
import ca.wilkinsonlab.sadi.service.annotations.InputClass; 
import ca.wilkinsonlab.sadi.service.annotations.OutputClass; 
import ca.wilkinsonlab.sadi.service.simple.SimpleSynchronousServiceServlet;

import com.hp.hpl.jena.rdf.model.Model; 
import com.hp.hpl.jena.rdf.model.ModelFactory; 
import com.hp.hpl.jena.rdf.model.Property; 
import com.hp.hpl.jena.rdf.model.Resource; 

/**
 * @author "Jose Cruz-Toledo"
 * ChebiSoapGetCharge
 */
@Name("ChebiSoapGetCharge")
@Description("This SADI service wraps the SOAP service ChebiWebServiceService located  at http://www.ebi.ac.uk/webservices/chebi/2.0/webservice?wsdl. 
It calls the operation getChebiAsciiName. This service takes as an input an instance of the class 
http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00030 
a ChEBI Entity that has attribute some ChEBI Identifier. It returns as an output
 an instance of the class http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00035, 
a ChEBI entity and has attribute some Charge. 
http://sadi-data.semanticscience.org/ChebiGetChargeSadiWrapper/input.rdf  contains an example of
 an input and http://sadi-data.semanticscience.org/ChebiGetChargeSadiWrapper/output.rdf contains 
the corresponding output.")
@ContactEmail("josemiguelcruztoledo@gmail.com")
@InputClass("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00030")
@OutputClass("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00035")
public class GetCharge extends SimpleSynchronousServiceServlet {
	private static final Logger log = Logger.getLogger(GetCharge.class);
	private static final long serialVersionUID = 1L;

	public void processInput(Resource input, Resource output) {
		/* your code goes here 
                 * (add properties to output node based on properties of input node…) 
                 */ 
	}

	@SuppressWarnings("unused")
	private static final class Vocab {
		private static Model m_model = ModelFactory.createDefaultModel();

		public static final Property chebi_soap_00052 = m_model
				.createProperty("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00052");
		public static final Property chebi_soap_00051 = m_model
				.createProperty("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00051");
		public static final Resource chebi_soap_00009 = m_model
				.createResource("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00009");
		public static final Resource chebi_soap_00030 = m_model
				.createResource("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00030");
		public static final Resource chebi_soap_00034 = m_model
				.createResource("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00034");
		public static final Resource Literal = m_model
				.createResource("http://www.w3.org/2000/01/rdf-schema#Literal");
		public static final Resource chebi_soap_00013 = m_model
				.createResource("http://sadi-ontology.semanticscience.org/chebi-sadi-soap.owl#chebi_soap_00013");
	}
}

}}}

At this stage you should also have the uk.

= External Links =
 * [http://sadiframework.org/content/getting-involved/what-is-a-sadi-service/ What is a Sadi Service?]
 * [http://sadiframework.org/content/getting-involved/building-a-sadi-service-in-java/ Building a SADI service in Java]
 * [http://sadiframework.org/registry/services/ The SADI service Registry]
 * [http://sadiframework.org/registry/register/ Register your SADI services]